<link href="css/bootstrap.min.css" rel="stylesheet">
<div class="container">
<div class="row">
<div class="col-lg-12">
                    <h1 class="page-header">ब्यानर : दर्ता</h1>
</div>
    <div class="col-xs-12 col-md-12 col-lg-12 col-sm-12">
        <div class="panel panel-red" >
            <div class="panel-heading">  ब्यानर दर्ता </div>
            <div class="panel-body">
                <div class="small-device-alert">
                     <div class="alert alert-danger">
                      For this operation you must have computer. It supports only on laptop, Desktop , PC .
                     </div>
                </div>
                <form id="banner_entry" action="{{url('/admin_area/ad_banner')}}" method="post"  enctype="multipart/form-data">
                    <div class="req-attention">Attention: '*' indicates necessary fields.  </div>
                    {{csrf_field()}}
                    <legend>  ब्यानर वा कम्पनीको :</legend>
                    <div class="sobiz-form-group">
                        क) दर्ता नं., मिति तथा कार्यालय:
                        <div class="sobiz-form-sub-group">
                          <div class="sb-row">
                            <div class="col-md-a">
                                ब्यानरको नाम नेपालीमा<span class="req"> * </span> :
                            </div>
                            <div class="col-md-b">
                                <input type="text" name="name" value="{{ old('name') }}" placeholder=" ब्लैक हर्स " required>
                            </div>
                          </div> 
                          <div class="sb-row">
                            <div class="col-md-a"> 
                                ब्यानरको नाम अंग्रेजीमा:<span class="req"> * </span> :
                            </div>
                            <div class="col-md-b">
                                <input type="text" name="name_en" value="{{ old('name_en') }}" placeholder=" Black Horse" required>
                            </div>
                         </div> 
                         <div class="sb-row"> 
                           <div class="col-md-a">
                                दर्ता नं.<span class="req"> * </span> :
                            </div>
                             <div class="col-md-b">
                                <input type="text" name="darta_number" value="{{ old('darta_number') }}" placeholder=" 87444 ">
                            </div>
                         </div>
                         <div class="sb-row">    
                            <div class="col-md-a">
                                मिति (वि. स.) <span class="req"> * </span>:
                            </div>
                             <div class="col-md-b">
                             <input type="text" name="darta_date" id="nepaliDate5" class="nepali-calendar" placeholder="2073-12-10"value="{{ old('darta_date') }}" required/>
                            </div>
                         </div>   
                        </div>
                    </div>                    
                     <div class="col-md-6 col-sm-6 col-xs-12 padding-both"> 
                    <div class="sobiz-form-group">
                        ख) शेयरधनीको नाम, ठेगाना, टेलिफोन नम्बर  <span class="req"> * </span>:
                    </div>
                    <div class="sobiz-form-group">
                         शेयरधनीको नाम :
                            <textarea class="sobiz-form-control" style="max-width: 100%;" rows="5" name="shareholder" id="shareholder" value="{{ old('shareholder') }}"></textarea>                     
                          <div class="sb-row">    
                              <div class="col-md-a">
                                   ठेगाना :
                              </div>
                              <div class="col-md-b">
                                  <input type="text" name="address" value="{{ old('address') }}" placeholder=" चावहिल, काठमाडौँ">
                              </div>
                          </div>
                          <div class="sb-row">    
                              <div class="col-md-a">
                                  टेलिफोन नम्बर :
                              </div>    
                              <div class="col-md-b">
                                  <input type="number" name="telephone" value="{{ old('telephone') }}" placeholder=" 01 4380001">
                              </div>
                     </div>         
                    </div> 
                    </div>
                    <div class="col-md-6 col-sm-6 col-xs-12 padding-both">
                         
                    </div>
                    <div class="sobiz-form-group">
                      <div class="sb-row">    
                        <div class="col-lg-a">क) उद्योग वा फर्म दर्ता प्रमाणपत्रको प्रतिलिपि :</div>
                        <div class="col-lg-b"><input style="display:inline-block;max-width: 100%;"type="file" name="darta_copy" accept="application/pdf">
                        <div class="size-inline">File size should not exceed 800KB </div></div>
                      </div>  
                    </div>
                    <div class="sobiz-form-group">
                      <div class="sb-row">  
                        <div class="col-lg-a">ख) कर प्रयोजनको लागि दर्ता भएको प्रमाणपत्रको प्रतिलिपि :</div>
                        <div class="col-lg-b"><input style="display:inline-block;max-width: 100%;"type="file" name="kar_copy" accept="application/pdf"> 
                        <div class="size-inline">File size should not exceed 800KB </div></div>
                      </div>  
                        <div  class="progress" style="display:none;">
          <div  class="progress-bar progress-bar-striped progress-bar-info active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" 
                      style="width:0%">
                     0%
                 </div>
                    </div>
                    <input type="submit" class="btn btn-primary" value="submit" style="float: right;"/>
                     
                </form>
            </div>
        </div>
    </div>
   </div> 
</div>
    <script>
        
        $(document).ready(function() {
            $('#nepaliDate5').nepaliDatePicker({
      npdMonth: true,
      npdYear: true,
      npdYearCount: 50
    });
            $("#banner_entry").validate({
                rules: {
                    name:{
                        required: true,
                        nepali:true,
                    },
                     name_en:{
                        required: true,
                        lettersonly:true,
                    },
                    darta_number:{
                        required: true,
                    },
                    

                },
                messages: {
                    name: {
                        required: "(कृपया ब्यानरको नाम लेख्नुहोस नेपालीमा /Please specify the name in Nepali  of your banner)",
                    },
                     name_en: {
                        required: "(कृपया ब्यानरको नाम लेख्नुहोस अंग्रेजीमा /Please specify the name in English of your banner)",
                    },
                    address: {
                        required:"(कृपया आफ्नो स्थायी ठेगाना लेख्नुहोस / Please specify your permanent address)",
                    },

                },
                submitHandler: function(form, e) {
                 //$(form).ajaxSubmit();
                 e.preventDefault();
                $('.progress-bar').removeClass('progress-bar-danger').addClass('progress-bar-info');
            var formData = new FormData(form);
            $.ajax({
                  type:'POST',
            url: '{{url('admin_area/ad_banner')}}',
            data:formData,
            beforeSend: function() {
              $('.progress').show();
          },
           xhr: function() {
                  var myXhr = $.ajaxSettings.xhr();
                  if(myXhr.upload){
                      myXhr.upload.addEventListener('progress',progress, false);
                  }
                   return myXhr;
           },
           cache:false,
          contentType: false,
          processData: false,

          success:function(data){
             //console.log(data);
            //alert('data returned successfully');
             if(data.status=='1'){
                 $('.progress-bar').removeClass('progress-bar-info').addClass('progress-bar-danger');
                $('.progress-bar').text('Already Exist');
                swal(
        'Oops...',
        data.msg,
        'error'
      );
             }
             else if(data.status=='4'){
                    $('.progress-bar').text('Completed');
                    $('#banner_entry')[0].reset();
                  swal(
          'Congratulaton',
           data.msg,
          'success'
         );
      }
      else{
        $('.progress-bar').removeClass('progress-bar-info').addClass('progress-bar-danger');
       $('.progress-bar').text('File Upload Errors');
      swal(
          'Oops...',
          data.msg,
          'error'
        );
      }
           },

          error: function(data){
            if(data.status===422 ) {
             var errors = data.responseJSON;
             errorsHtml = '<ul>';

                 $.each( errors , function( key, value ) {
                     errorsHtml += '<li>' + value[0] + '</li>'; //showing only the first error.
                     });
                     errorsHtml += '</ul>';
                 console.log(errorsHtml);
                  $('.progress-bar').removeClass('progress-bar-info').addClass('progress-bar-danger');
                 $('.progress-bar').text('Failed Due to errors');
                 swal(
        'Failed...',
        errorsHtml,
        'error'
      );
      }else{
         console.log(errors);
                     swal(
          'Oops...',
          data,
          'error'
      );
      }
           }
         });

        e.preventDefault();
                 }
            })

        });
        
        function progress(e){
      if(e.lengthComputable){
          var max = e.total;
          var current = e.loaded;
           var Percentage = parseInt((current * 100)/max);
          console.log(Percentage);
               $('.progress-bar').css('width', Percentage+'%').attr('aria-valuenow', Percentage);
    $('.progress-bar').text(Percentage+'%');
          if(Percentage >= 100)
           {
            // process completed  
            $('.progress-bar').css('width','100%').attr('aria-valuenow', '100');
    $('.progress-bar').text('Processsing');
          }
         }  
  }
    </script>